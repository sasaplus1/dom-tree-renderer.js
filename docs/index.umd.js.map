{"version":3,"file":"index.umd.js","sources":["../src/utility.ts","../src/dom.ts","../src/text.ts"],"sourcesContent":["/** regex for escape control characters  */\nexport const escapeControlCharacterRegex = /[\\0\\b\\f\\n\\r\\t\\v]/g;\n\n/**\n * escape control characters for String.replace\n *\n * @param match - match text\n * @returns replaced text\n */\nexport function escapeControlCharacter(match: string): string {\n  switch (match) {\n    case '\\0':\n      return '\\\\0';\n    case '\\b':\n      return '\\\\b';\n    case '\\f':\n      return '\\\\f';\n    case '\\n':\n      return '\\\\n';\n    case '\\r':\n      return '\\\\r';\n    case '\\t':\n      return '\\\\t';\n    case '\\v':\n      return '\\\\v';\n    default:\n      return match;\n  }\n}\n","import { escapeControlCharacterRegex, escapeControlCharacter } from './utility';\n\nexport type CarryOverParams = {\n  depth: number;\n  isLastSibling: boolean;\n};\n\nexport type CreateTreeNode = (\n  node: Node,\n  parent: Node,\n  params: CarryOverParams\n) => Node;\n\nexport type DomTreeOptions = {\n  createTreeNode: CreateTreeNode;\n};\n\nexport const createDetailsTreeNode: CreateTreeNode = (node) => {\n  if (node.nodeType === Node.TEXT_NODE) {\n    const str = (node.textContent || '').replace(\n      escapeControlCharacterRegex,\n      escapeControlCharacter\n    );\n\n    const text = document.createTextNode(str);\n    const span = document.createElement('span');\n\n    span.appendChild(text);\n\n    return span;\n  }\n\n  const details = document.createElement('details');\n  const summary = document.createElement('summary');\n\n  summary.textContent = node.nodeName;\n  details.appendChild(summary);\n\n  return details;\n};\n\nexport function createListTreeNodeClosure(): CreateTreeNode {\n  // let previousDepth = NaN;\n\n  return function createListTreeNode(node, _parent, _params) {\n    // const { depth } = params;\n\n    const ul = document.createElement('ul');\n    const li = document.createElement('li');\n\n    li.textContent = node.nodeName;\n    ul.appendChild(li);\n\n    return ul;\n  };\n}\n\nexport function domTree(\n  node: Node,\n  options: DomTreeOptions = {\n    createTreeNode: createListTreeNodeClosure()\n  },\n  carryOverParams: CarryOverParams = {\n    depth: 0,\n    isLastSibling: false\n  },\n  parent: Node = document.createDocumentFragment()\n): Node {\n  const { createTreeNode } = options;\n  const { depth } = carryOverParams;\n\n  const item = createTreeNode(node, parent, { ...carryOverParams });\n\n  parent.appendChild(item);\n\n  for (let i = 0, len = node.childNodes.length; i < len; i += 1) {\n    const childNode = node.childNodes[i];\n\n    if (!childNode) {\n      continue;\n    }\n\n    domTree(\n      childNode,\n      options,\n      {\n        depth: depth + 1,\n        isLastSibling: i === len - 1\n      },\n      item\n    );\n  }\n\n  return parent;\n}\n","import { escapeControlCharacterRegex, escapeControlCharacter } from './utility';\n\n/** tree shapes */\nexport type TreeShape = {\n  Empty: string;\n  I: string;\n  L: string;\n  T: string;\n};\n\nexport type RenderNode = (node: Node) => string;\n\n/** treeText() options */\nexport type TextTreeOptions = {\n  renderNode: RenderNode;\n  shapes: TreeShape;\n};\n\ntype CarryOverParams = {\n  depth: number;\n  isLastSibling: boolean;\n  prefix: string;\n};\n\n/**\n * default renderNode function\n *\n * @param node - DOM node\n * @returns rendered node text\n */\nexport const defaultRenderNode: RenderNode = (node) => {\n  return node.nodeType === Node.TEXT_NODE\n    ? (node.textContent || '').replace(\n        escapeControlCharacterRegex,\n        escapeControlCharacter\n      )\n    : node.nodeName.toLowerCase();\n};\n\n/** shape texts by ASCII */\nexport const asciiShapes = {\n  Empty: '   ',\n  I: '|  ',\n  L: '|- ',\n  T: '|- '\n} as const satisfies TreeShape;\n\n/** shape texts by Unicode */\nexport const unicodeShapes = {\n  Empty: '   ',\n  I: '│  ',\n  L: '└─ ',\n  T: '├─ '\n} as const satisfies TreeShape;\n\n/** textTree() default options */\nexport const defaultOptions: TextTreeOptions = {\n  renderNode: defaultRenderNode,\n  shapes: { ...asciiShapes }\n};\n\n/**\n * render DOM tree to text\n *\n * @param node - DOM node\n * @param options - options\n * @param carryOverParams - carry over params, not for user\n * @param result - result, not for user\n * @returns DOM tree array\n * @example\n * ```js\n * textTree(document.body).join('\\n');\n * ```\n * ```js\n * textTree(document.documentElement, {\n *   renderNode(node) {\n *     return `<${node.nodeName.toLowerCase()}>`;\n *   },\n *   shapes: {\n *     Empty: '   ',\n *     I: '|  ',\n *     L: '+─ ',\n *     T: '*- '\n *   }\n * }).join('<br>');\n * ```\n */\nexport function textTree(\n  node: Node,\n  options: TextTreeOptions = {\n    ...defaultOptions\n  },\n  carryOverParams: CarryOverParams = {\n    depth: 0,\n    isLastSibling: false,\n    prefix: ''\n  },\n  result: string[] = []\n): string[] {\n  const { renderNode, shapes } = options;\n  const { Empty: emptyShape, I: iShape, L: lShape, T: tShape } = shapes;\n\n  const { depth, isLastSibling, prefix } = carryOverParams;\n\n  const isRoot = depth === 0;\n  const treeText = isRoot ? '' : isLastSibling ? lShape : tShape;\n\n  result.push(prefix + treeText + renderNode(node));\n\n  for (let i = 0, len = node.childNodes.length; i < len; i += 1) {\n    const childNode = node.childNodes[i];\n\n    if (!childNode) {\n      continue;\n    }\n\n    const childTreeText = isRoot ? '' : isLastSibling ? emptyShape : iShape;\n\n    textTree(\n      childNode,\n      options,\n      {\n        depth: depth + 1,\n        isLastSibling: i === len - 1,\n        prefix: prefix + childTreeText\n      },\n      result\n    );\n  }\n\n  return result;\n}\n"],"names":["escapeControlCharacterRegex","escapeControlCharacter","match","createListTreeNodeClosure","node","_parent","_params","ul","document","createElement","li","textContent","nodeName","appendChild","defaultRenderNode","nodeType","Node","TEXT_NODE","replace","toLowerCase","asciiShapes","Empty","I","L","T","defaultOptions","renderNode","shapes","_extends","str","text","createTextNode","span","details","summary","domTree","options","carryOverParams","parent","createTreeNode","depth","isLastSibling","createDocumentFragment","item","i","len","childNodes","length","childNode","textTree","result","prefix","emptyShape","iShape","isRoot","push"],"mappings":"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"}